<?php
require __DIR__ . '/vendor/autoload.php';

use LINE\LINEBot;
use LINE\LINEBot\HTTPClient\CurlHTTPClient;
use LINE\LINEBot\Event\MessageEvent\TextMessage;

$channelAccessToken = 'PjdiueZA2g+GWvHugLdfAjszK7Hl2ORp0jSr+YFGrz9qsnYyjgHVYP03gEvlRTfAYUA9uf4elgZ2XjsPie1UNSg8lDKq7JZU6Hy7/HEqcPHJwbIhJ/Q6mlYOHL2pmWMJgcLTl7RkzWAFcl3jSxUoEAdB04t89/1O/w1cDnyilFU=';
$channelSecret = '503dc452fd3e67a681be33a9675c5204';

$httpClient = new CurlHTTPClient($channelAccessToken);
$bot = new LINEBot($httpClient, ['channelSecret' => $channelSecret]);

$signature = $_SERVER['HTTP_' . \LINE\LINEBot\Constant\HTTPHeader::LINE_SIGNATURE];
$body = file_get_contents('php://input');

try {
    $events = $bot->parseEventRequest($body, $signature);
} catch (Exception $e) {
    error_log($e->getMessage());
    http_response_code(500);
    exit;
}

foreach ($events as $event) {
    if ($event instanceof TextMessage) {
        $messageText = $event->getText();
        
        if ($messageText == 'สวัสดี') {
            $replyText = 'ว่าไงชาวโลก มีอะไรให้เราช่วย';
        } elseif ($messageText == 'กยศกู้ได้ถึงวันไหน') {
            $replyText = 'กยศสามารถกู้ได้ตั้งแต่เดือนเมษายนของทุกปี';
        } elseif ($messageText == 'กยศคืออะไร') {
            $replyText = 'กยศหมายถึง กองทุนผู้เรียนยินดีกู้ยืมเพื่อการศึกษา ซึ่งเป็นการกู้ยืมเงินจากภาครัฐเพื่อใช้ในการศึกษา มีอัตราดอกเบี้ยต่ำกว่าเงินกู้ทั่วไปและมีระยะเวลาผ่อนชำระที่ยืดหยุ่นกว่า.';
        } elseif ($messageText == 'วิธีการสมัครกยศ') {
            $replyText = 'นักศึกษาสามารถสมัครกยศได้ทางอินเทอร์เน็ตผ่านเว็บไซต์ของกยศหรือผ่านช่องทางที่กำหนดไว้ ซึ่งต้องเตรียมเอกสารที่เกี่ยวข้องตามที่กำหนด หรือปรึกษาคณะอาจารย์';
        } elseif ($messageText == 'ดอกเบี้ยกยศ') {
            $replyText = 'เงื่อนไขและอัตราดอกเบี้ยของกยศจะต่างกันไปตามประเภทของกยศ แต่ส่วนใหญ่จะมีอัตราดอกเบี้ยต่ำกว่าเงินกู้เพื่อการศึกษาจากภาคเอกชน.';
        } elseif ($messageText == 'เอกสารที่ใช้กู้ยืม กยศ') {
            $replyText = 'ใบคำขอกยศ (หรือแบบฟอร์มขอกยศ): เป็นเอกสารที่ต้องกรอกข้อมูลส่วนตัวของนักศึกษาและข้อมูลเกี่ยวกับการศึกษา เช่น ชื่อ-สกุล, หมายเลขบัตรประชาชน, ข้อมูลการศึกษาของนักศึกษา เป็นต้น

สำเนาบัตรประชาชน: ใช้เพื่อยืนยันตัวตนของผู้ขอกยศ

สำเนาทะเบียนบ้าน: เพื่อยืนยันที่อยู่ปัจจุบันของผู้ขอกยศ

รายละเอียดเกี่ยวกับการศึกษา: เช่น ใบแสดงผลการเรียน, ใบรับรองการเข้าศึกษา (หรือใบเข้าศึกษา), รายละเอียดเกี่ยวกับหลักสูตรที่กำลังศึกษาอยู่ เป็นต้น

หลักฐานทางการเงิน: เช่น ใบรับรองการเป็นนักศึกษาจากสถานศึกษา, หนังสือรับรองจากผู้ปกครองหรือผู้อุปถัมภ์ และเอกสารอื่น ๆ ที่เกี่ยวข้องกับสภาพการเงินของนักศึกษาหรือครอบครัว

เอกสารประกอบเพิ่มเติม: อาจจำเป็นต้องมีเอกสารเพิ่มเติมตามความต้องการของหน่วยงานที่ให้กยศ เช่น หนังสือรับรองตัวตนเพิ่มเติม, หลักฐานเกี่ยวกับสิทธิ์เข้าศึกษา, หลักฐานเกี่ยวกับการชำระค่าธรรมเนียมการศึกษา เป็นต้น

การตรวจสอบข้อมูลและเตรียมเอกสารให้ครบถ้วนและถูกต้องเป็นสิ่งสำคัญ เนื่องจากข้อบังคับและเงื่อนไขอาจแตกต่างกันไปตามแต่ละหน่วยงานหรือสถาบันที่ให้กยศ';
        } elseif ($messageText == 'กู้ กยศ. ได้เงินเท่าไหร') {
            $replyText = 'เงินที่กู้ได้ ขึ้นอยู่กับหลักสูตรที่ศึกษา  โดยแบ่งเป็น 3 ระดับ ดังนี้

ระดับ ปริญญาตรี: กู้ได้ไม่เกิน 25,000 บาทต่อปีการศึกษา
ระดับ ปริญญาโท: กู้ได้ไม่เกิน 35,000 บาทต่อปีการศึกษา
ระดับ ปริญญาเอก: กู้ได้ไม่เกิน 45,000 บาทต่อปีการศึกษา';
        } elseif ($messageText == 'ใครบ้างที่มีสิทธิ์กู้ กยศ') {
            $replyText = 'นักศึกษาที่กำลังศึกษาอยู่ในสถาบันอุดมศึกษาที่ได้รับการรับรองจากกระทรวงศึกษาธิการ  ซึ่งเป็นนักศึกษาไทย  เรียนหลักสูตรที่เปิดสอนไม่เกิน 5 ปี  และมีผลการเรียนตามเกณฑ์ที่กองทุนกำหนด';
        } elseif ($messageText == 'วิธีการกู้ กยศ. มีอะไรบ้าง'){
            $replyText = 'ยื่นใบสมัครผ่านระบบออนไลน์ https://www.studentloan.or.th/
ยื่นใบสมัครผ่านสถานศึกษา';
        }elseif ($messageText == 'มีวิธีผ่อนชำระเงิน กยศ. แบบไหนบ้าง'){
            $replyText = 'มีวิธีผ่อนชำระเงิน กยศ. ดังนี้
ผ่อนชำระแบบเท่าจำนวนเงินต้นและดอกเบี้ยคงที่
ผ่อนชำระแบบลดต้นลดดอก
ผ่อนชำระแบบขั้นบันได';
        }elseif ($messageText == 'หากไม่ชำระเงิน กยศ. จะเป็นอย่างไร'){
            $replyText = 'หากผู้กู้ยืมไม่ชำระเงิน กยศ. ตามกำหนด  กยศ. จะดำเนินการดังนี้
แจ้งเตือนให้ชำระหนี้
ดำเนินการฟ้องร้องดำเนินคดี
อายัดเงินเดือน
ระงับการทำธุรกรรมทางการเงิน';
        }elseif ($messageText == 'ต้องชำระเงินคืน กยศ. เมื่อไหร่'){
            $replyText = 'ผู้กู้ยืมต้องเริ่มชำระเงินคืน กยศ. ภายใน 1 ปีหลังจากสำเร็จการศึกษา หรือเลิกเรียน  โดยสามารถเลือกชำระได้หลายช่องทาง เช่น ผ่านธนาคาร  เคาน์เตอร์เซอร์วิส  หรือหักเงินเดือน';
        }
        else {
            $replyText = 'ขอโทษค่ะ ฉันไม่เข้าใจคำถาม';
        }
        
        $response = $bot->replyText($event->getReplyToken(), $replyText);
        if (!$response->isSucceeded()) {
            error_log('Failed to reply: ' . $response->getRawBody());
        }
    }
}

http_response_code(200);
